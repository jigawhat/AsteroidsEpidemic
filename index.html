<html>
<head>
<style>
body {
    text-align: center;
}
canvas {
    border: 1px solid #d3d3d3;
    background-color: #f1f1f1;
}
</style>
</head>
<body onload="startGame()">
<!-- <center> -->
<!-- <canvas id="myCanvas" width="800" height="600" style="border:1px solid #000000;">
</canvas> -->

<!-- <script>
var c = document.getElementById("myCanvas");
var ctx = c.getContext("2d");
ctx.moveTo(0, 0);
ctx.lineTo(200, 100);
ctx.stroke();
</script> -->

<script>

var ship;
var missiles = [];
var firing = false;

function startGame() {
  myGameArea.start();
  ship = new Ship(10, 120);
}

var myGameArea = {
  canvas : document.createElement("canvas"),
  start : function() {
    this.canvas.width = 800;
    this.canvas.height = 600;
    this.context = this.canvas.getContext("2d");
    document.body.insertBefore(this.canvas, document.body.childNodes[0]);
    this.interval = setInterval(updateGameArea, 20);

    window.addEventListener('keydown', function (e) {
      myGameArea.keys = (myGameArea.keys || []);
      myGameArea.keys[e.keyCode] = true;
      // alert("Key " + e.keyCode + " pressed.");
    })
    window.addEventListener('keyup', function (e) {
      myGameArea.keys[e.keyCode] = false;
    })
  },
  clear : function() {
    this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);
  }
}

class MovingObject {
  constructor(x, y) {
    this.speedX = 0;
    this.speedY = 0;
    this.angle = 0;
    this.moveAngle = 0;
    this.x = x;
    this.y = y;
  }
  newPos() {
    this.x += this.speedX;
    this.y += this.speedY;
    this.angle += this.moveAngle;
  }
}

class Missile extends MovingObject {
  constructor(x, y, angle, speedX, speedY) {
    super(x, y);
    var angleCos = Math.cos(angle);
    var angleSin = Math.sin(angle);
    this.speedX = speedX + (5.5 * angleCos);
    this.speedY = speedY + (5.5 * angleSin);
    this.trailOffsetX = 15 * angleCos;
    this.trailOffsetY = 15 * angleSin;
  }
  update() {
    var ctx = myGameArea.context;
    ctx.beginPath();
    ctx.moveTo(this.x, this.y);
    ctx.lineTo(this.x + this.trailOffsetX, this.y + this.trailOffsetY);
    ctx.stroke();
  }
}

class Ship extends MovingObject {

  constructor(x, y) {
    super(x, y);
  }
  update() {
    var ctx = myGameArea.context;
    ctx.save();
    ctx.translate(this.x, this.y);
    ctx.rotate(this.angle);

    // ctx.fillStyle = color;
    // ctx.fillRect(this.x, this.y, this.width, this.height);
    ctx.beginPath();
    ctx.moveTo(10, 15);
    ctx.lineTo(0, -15);
    ctx.lineTo(-10, 15);
    ctx.moveTo(7, 7.5);
    ctx.lineTo(-7, 7.5);
    ctx.stroke();

    ctx.restore();
  }
}

function updateGameArea() {
  myGameArea.clear();
  // ship.speedX = 0;
  // ship.angle += 1 * Math.PI / 180;
  // ship.speedY = 0;
  ship.moveAngle = 0;
  if (myGameArea.keys && myGameArea.keys[37]) {ship.moveAngle = -5.5 * Math.PI / 180}
  if (myGameArea.keys && myGameArea.keys[39]) {ship.moveAngle = 5.5 * Math.PI / 180}
  if (myGameArea.keys && myGameArea.keys[38]) {
    ship.speedX += 0.1 * Math.cos(ship.angle - Math.PI / 2);
    ship.speedY += 0.1 * Math.sin(ship.angle - Math.PI / 2);
  }
  // if (myGameArea.keys && myGameArea.keys[37]) {ship.speedX = -1; }
  // if (myGameArea.keys && myGameArea.keys[39]) {ship.speedX = 1; }
  // if (myGameArea.keys && myGameArea.keys[38]) {ship.speedY = -1; }
  // if (myGameArea.keys && myGameArea.keys[40]) {ship.speedY = 1; }

  if (myGameArea.keys && myGameArea.keys[32]) {
    if (!firing) {
      firing = true;
      missiles.push(new Missile(ship.x, ship.y, ship.angle - Math.PI / 2,
        ship.speedX, ship.speedY));
    }
  } else {
    firing = false;
  }

  for (let i = 0; i < missiles.length; i++) {
    missiles[i].newPos();
    missiles[i].update();
  }

  ship.newPos();
  ship.update();
}


</script>

<!-- </center> -->
</body>
</html>